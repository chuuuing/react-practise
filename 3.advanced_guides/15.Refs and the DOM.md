
`ref`æ˜¯ reference çš„ç¼©å†™ï¼Œä»£è¡¨â€œå¼•ç”¨â€ï¼Œæœ‰ç‚¹åƒä¸€ä¸ªæ‰‹æŒ‡ ğŸ‘†ï¼ŒæŒ‡å‘å½“å‰é¡µé¢ä¸­çš„ **DOM node** æˆ–è€… **React element**ã€‚

åœ¨å…¸å‹çš„ React æ•°æ®æµä¸­ï¼Œ`props` æ˜¯çˆ¶ç»„ä»¶ä¸å­ç»„ä»¶äº¤äº’çš„å”¯ä¸€æ–¹å¼ã€‚è¦ä¿®æ”¹ä¸€ä¸ªå­ç»„ä»¶ï¼Œä½ éœ€è¦ä½¿ç”¨æ–°çš„ props æ¥é‡æ–°æ¸²æŸ“å®ƒã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦åœ¨å…¸å‹æ•°æ®æµä¹‹å¤–**å¼ºåˆ¶**ä¿®æ”¹å­ç»„ä»¶ï¼ˆå­ç»„å»ºå¯ä»¥æ˜¯ React æˆ–è€… DOM elementï¼‰ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°`ref`ã€‚

# ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨`ref`ï¼Ÿ

- è°ƒæ•´ focusï¼Œæ–‡å­—é€‰æ‹©ï¼Œæ’­æ”¾ mediaï¼ˆvideoï¼‰
- è§¦å‘åŠ¨ç”»
- ä¸ç¬¬ä¸‰æ–¹ DOM åº“è¿›è¡Œé›†æˆ

# âš ï¸ ä¸è¦è¿‡åº¦ä½¿ç”¨`ref`

æœ‰æ—¶å€™æŠŠ state å¾€çˆ¶ component é‚£é‡Œæé«˜ä¸€ä¸ªå±‚æ¬¡æ‰æ˜¯æ›´å¥½çš„åŠæ³•ã€‚

# å¦‚ä½•åˆ›å»º`ref`

## CLASS COMPONENT

æœ€åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•ï¼š

```js
import React from "react";

class MyComponent extends Component {
  constructor(props) {
    super(props);
    this.myRef = React.createRef();
  }

  render() {
    return <div ref={this.myRef} />;
  }
}

export default MyComponent;
```

å¸¸è§ç”¨æ³•ï¼šå°† focus è½¬ç§»åˆ°æ–‡æœ¬è¾“å…¥å…ƒç´ ï¼ˆnative DOM `<input>`å…ƒç´ ï¼‰ä¸Šï¼š

```js
class TextInputWithFocusButton extends React.Component {
  constructor(props) {
    super(props);
    // åˆ›å»ºä¸€ä¸ª ref æ¥å­˜å‚¨ textInput çš„ DOM å…ƒç´ 
    this.textInput = React.createRef();
    this.focusTextInput = this.focusTextInput.bind(this);
  }

  focusTextInput() {
    // ç›´æ¥ä½¿ç”¨åŸç”Ÿ API ä½¿ text è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹ã€‚é€šè¿‡ "current" æ¥è®¿é—® DOM èŠ‚ç‚¹
    this.textInput.current.focus();
  }

  render() {
    // å‘Šè¯‰ React æˆ‘ä»¬æƒ³æŠŠ <input> ref å…³è”åˆ°æ„é€ å™¨é‡Œåˆ›å»ºçš„ `textInput` ä¸Š
    return (
      <>
        <input type="text" ref={this.textInput} />
        <button onClick={this.focusTextInput}>Focus the input</button>
      </>
    );
  }
}
```

åœ¨ä¸Šé¢ç»„å»º`TextInputWithFocusButton`çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ ref åœ¨è¯¥ç»„ä»¶å¤–é¢è°ƒç”¨è¯¥ç»„ä»¶çš„æ–¹æ³•`focusTextInput()`ï¼š

```js
class AutoFocusTextInput extends React.Component {
  constructor(props) {
    super(props);
    this.textInput = React.createRef();
  }

  componentDidMount() {
    // currentä»£è¡¨å½“å‰component "CustomTextInput"
    this.textInput.current.focusTextInput();
  }

  render() {
    return <CustomTextInput ref={this.textInput} />;
  }
}
```

## FUNCTION COMPONENT

`useRef(initialValue)` è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå…¶ .current å±æ€§ç­‰äºåˆå§‹åŒ–æ—¶ä¼ å…¥çš„`initialValue`ã€‚

æœ€åŸºæœ¬çš„ä½¿ç”¨æ–¹æ³•ï¼š

```js
import { useRef } from "react";

function MyComponent() {
  const refContainer = useRef();

  return <div ref={refContainer} />;
}

export default MyComponent;
```

å¸¸è§ç”¨æ³•ï¼šå°† focus è½¬ç§»åˆ°æ–‡æœ¬è¾“å…¥å…ƒç´ ï¼ˆnative DOM `<input>`å…ƒç´ ï¼‰ä¸Šï¼š

```js
function TextInputWithFocusButton() {
  const inputEl = useRef(null);
  const focusTextInput = () => {
    // `current` æŒ‡å‘å·²æŒ‚è½½åˆ° DOM ä¸Šçš„æ–‡æœ¬è¾“å…¥å…ƒç´ 
    inputEl.current.focus();
  };
  return (
    <>
      <input ref={inputEl} type="text" />
      <button onClick={focusTextInput}>Focus the input</button>
    </>
  );
}
```

# `ref`çš„å›è°ƒï¼ˆcallbackï¼‰

`ref`çš„å›è°ƒèƒ½åŠ©ä½ æ›´ç²¾ç»†åœ°æ§åˆ¶ä½•æ—¶ refs è¢«è®¾ç½®å’Œè§£é™¤ã€‚ä¸åŒäºä¼ é€’ `createRef()` åˆ›å»ºçš„ `ref` å±æ€§ï¼Œä½ ä¼šä¼ é€’ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸­æ¥å— React ç»„ä»¶å®ä¾‹æˆ– HTML DOM å…ƒç´ ä½œä¸ºå‚æ•°ï¼Œä»¥ä½¿å®ƒä»¬èƒ½åœ¨å…¶ä»–åœ°æ–¹è¢«å­˜å‚¨å’Œè®¿é—®ã€‚

è¿™ä¸ªä¾‹å­æ˜ç¡®è§„å®šåœ¨ç»„ä»¶**æŒ‚è½½ï¼ˆmountï¼‰**åï¼Œè®©æ–‡æœ¬æ¡†è‡ªåŠ¨è·å¾—ç„¦ç‚¹ - å› ä¸ºåœ¨`componentDidMount()`æ–¹æ³•ä¸­è°ƒç”¨äº†`focusTextInput()`

```js
class CustomTextInput extends Component {
  constructor(props) {
    super(props);
    this.textInput = null;
    this.setTextInputRef = (element) => {
      this.textInput = element;
    };
    this.focusTextInput = () => {
      // ä½¿ç”¨åŸç”Ÿ DOM API ä½¿ text è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
      if (this.textInput) this.textInput.focus();
    };
  }

  componentDidMount() {
    // ç»„ä»¶æŒ‚è½½åï¼Œè®©æ–‡æœ¬æ¡†è‡ªåŠ¨è·å¾—ç„¦ç‚¹
    this.focusTextInput();
  }

  render() {
    return (
      <div>
        <input type="text" ref={this.setTextInputRef} />
        <input
          type="button"
          value="Focus on the text input"
          onClick={this.focusTextInput}
        />
      </div>
    );
  }
}

export default CustomTextInput;
```
